<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.69.0" />

    
    
    

<title>GSoC Week 2 • zshzero</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="GSoC Week 2"/>
<meta name="twitter:description" content="After Building and Installing crOS for amd64, i just needed a google account to sign in and was ready to go
crosh is the terminal prompt used by crOS which can be opened by crtl&#43;alt&#43;t and the first warning the shell gave was:
bash: warning: /home/chronos/user/.bash_profile: warning: script from noexec mount; see https://chromium.googlesource.com/chromiumos/docs/&#43;/master/security/noexec_shell_scripts.md
bash: warning: /home/chronos/user/.bashrc: warning: script from noexec mount; see https://chromium.googlesource.com/chromiumos/docs/&#43;/master/security/noexec_shell_scripts.md
CrOS has noexec option in order to reject attempts to execute code as a part of its extremely security."/>

<meta property="og:title" content="GSoC Week 2" />
<meta property="og:description" content="After Building and Installing crOS for amd64, i just needed a google account to sign in and was ready to go
crosh is the terminal prompt used by crOS which can be opened by crtl&#43;alt&#43;t and the first warning the shell gave was:
bash: warning: /home/chronos/user/.bash_profile: warning: script from noexec mount; see https://chromium.googlesource.com/chromiumos/docs/&#43;/master/security/noexec_shell_scripts.md
bash: warning: /home/chronos/user/.bashrc: warning: script from noexec mount; see https://chromium.googlesource.com/chromiumos/docs/&#43;/master/security/noexec_shell_scripts.md
CrOS has noexec option in order to reject attempts to execute code as a part of its extremely security." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zshzero.github.io/blog/gsoc/week2/" />
<meta property="article:published_time" content="2020-06-14T09:52:56+05:30" />
<meta property="article:modified_time" content="2020-06-14T09:52:56+05:30" /><meta property="og:site_name" content="Title" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/blog/scss/hyde-hyde.3081c4981fb69a2783dd36ecfdd0e6ba7a158d4cbfdd290ebce8f78ba0469fc6.css" integrity="sha256-MIHEmB&#43;2mieD3Tbs/dDmunoVjUy/3SkOvOj3i6BGn8Y=">


<link rel="stylesheet" href="/blog/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://zshzero.github.io/blog/">zshzero</a>
      </span>
      
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">zshzero</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/blog/aboutme">
						<span>About Me</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/blog/project">
						<span>My Project</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/blog/gsoc">
						<span>Weekly Updates</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/zshzero" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/zshzero" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<a href="https://www.reddit.com/user/zshzero" rel="me"><i class="fab fa-reddit-alien fa-lg" aria-hidden="true"></i></a>
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2020 zshzero
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>GSoC Week 2</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jun 14, 2020
    
    
    
    
    
    <br/>
    <i class="fas fa-clock"></i> 4 min read
</div>


  </header>
  
  
  <div class="post">
    <p>After Building and Installing crOS for amd64, i just needed a google account to sign in and was ready to go</p>
<p><a href="https://chromium.googlesource.com/chromiumos/platform2/+/master/crosh/README.md#Crosh-The-Chromium-OS-shell">crosh</a> is the terminal prompt used by crOS which can be opened by crtl+alt+t and the first warning the shell gave was:</p>
<p><code>bash: warning: /home/chronos/user/.bash_profile: warning: script from noexec mount; see https://chromium.googlesource.com/chromiumos/docs/+/master/security/noexec_shell_scripts.md</code></p>
<p><code>bash: warning: /home/chronos/user/.bashrc: warning: script from noexec mount; see https://chromium.googlesource.com/chromiumos/docs/+/master/security/noexec_shell_scripts.md</code></p>
<p>CrOS has noexec option in order to reject attempts to execute code as a part of its extremely security. So, I had to remount the partition with exec(permits to execute binaries) and rw(permits to read/write filesystem)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo mount -o rw,exec,remount /
sudo mount -o rw,exec,remount /var
sudo mount -o rw,exec,remount /home/chronos/user
</code></pre></div><p>I cloned the previously built toolchain from <a href="https://gitlab.com/zshzero/cross-x86_64-cros-linux-gnu">gitlab</a>, renamed the folder as x86_64-cros-linux-gnu and moved to /usr/local. Also, I set path in ~/.bashrc</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export PATH<span style="color:#f92672">=</span>/usr/local/x86_64-cros-linux-gnu/bin:$PATH
export LD_LIBRARY_PATH<span style="color:#f92672">=</span>/usr/local/x86_64-cros-linux-gnu/x86_64-cros-linux-gnu/lib64:$LD_LIBRARY_PATH
</code></pre></div><p>Symlink toolchain binaries to /usr/bin/</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo ln -s /usr/local/x86_64-cros-linux-gnu/bin/x86_64-cros-linux-gnu-cc /usr/bin/cc
sudo ln -s /usr/local/x86_64-cros-linux-gnu/bin/x86_64-cros-linux-gnu-gcc /usr/bin/gcc
</code></pre></div><ul>
<li>Create symlink like above if something complains about missing commands</li>
</ul>
<p>Configuring the repository can be done in a few simple steps. First, if it does not exist, create the repos.conf directory, then copy the Gentoo repository configuration file provided <a href="https://wiki.gentoo.org/wiki//etc/portage/repos.conf/gentoo.conf">here</a> to /etc/portage/repos.conf/gentoo.conf</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo mkdir -p /etc/portage/repos.conf
sudo nano /etc/portage/repos.conf/gentoo.conf <span style="color:#75715e">#paste the content</span>
</code></pre></div><p>Fetch the latest snapshot (which is released on a daily basis) from one of Gentoo&rsquo;s mirrors and install it onto the system</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo emerge-webrsync
</code></pre></div><ul>
<li>(Optional) <code>emerge --sync</code> command will use the rsync protocol to update the Gentoo ebuild repository(up to 1 hour) which was fetched earlier on through emerge-webrsync</li>
</ul>
<p>Now, build make tool which helps in generation of executables from program&rsquo;s source files</p>
<p>Download the latest tar from <a href="https://ftp.gnu.org/gnu/make/">Link</a>, extract and build it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">tar -xzf make-4.3.tar.gz
sudo ./configure --disable-dependency-tracking --prefix<span style="color:#f92672">=</span>/usr/local
sudo ./build.sh
sudo ./make
sudo ./make install 
</code></pre></div><p>And patch tool for producing patched versions of the package</p>
<p>Download the latest tar from <a href="https://ftp.gnu.org/gnu/patch/">Link</a>, extract and build it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">tar -xzf patch-2.7.tar.gz
sudo ./configure --prefix<span style="color:#f92672">=</span>/usr/local
sudo make
sudo make install 
</code></pre></div><p>Now the toolchain is set, we need to instruct portage to compile and build the package. But crOS downloads packages from where binhost is pointing and only emerges them. So, we need to remove that option out from /etc/portage/make.profile/make.defaults</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#Comment the line below</span>
EMERGE_DEFAULT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;--getbinpkgs --usepkgonly&#34;</span>
</code></pre></div><p>Then, I setup the make.conf for portage (<a href="https://pastebin.com/fvqL684P">My make.conf</a>)</p>
<p>I wanted to update the profile to latest(17.1) as CrOS uses a old profile(10.0). I made a backup of existing profile (because it was not a symlink) and set it to <code>default/linux/amd64/17.1/desktop</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo emerge -a app-admin/eselect
sudo mv /etc/portage/make.profile /etc/portage/make.profile.bak 
sudo eselect profile set default/linux/amd64/17.1/desktop
</code></pre></div><p>While trying to update the world, it gave a circular dependencies of gcc and glibc. So removed the symlink and used the backup(default profile).</p>
<p>I decided to emerge both and started with sys-devel/binutils <code>sudo emerge -a sys-devel/binutils</code> and the first warning was <code> </code></p>
<p>Commenting app-portage/elt-patches and sys-develel/m4 in /etc/portage/make.profile/package.provided/package.provided</p>
<ul>
<li>During error, <code>Could not find source /lib/gentoo/functions.sh!</code><br>
I Added <a href="https://github.com/gentoo/gentoo-functions/blob/master/functions.sh">/lib/gentoo/functions.sh</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo mkdir /lib/gentoo
sudo nano /lib/gentoo/functions.sh <span style="color:#75715e"># Paste the content from the link</span>
</code></pre></div><p>And again tried to emerge binutils, <code>Error: zlib.h : No such file or directory</code></p>
<p>So, i installed that library</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo emerge -a sys-libs/zlib
</code></pre></div><p>But it still complained about it.</p>
<p>After referring from stackoverflow, <a href="https://stackoverflow.com/questions/4980819/what-are-the-gcc-default-include-directories">Link 1</a> and <a href="https://stackoverflow.com/questions/16710047/usr-bin-ld-cannot-find-lnameofthelibrary/21647591#21647591">Link 2</a></p>
<p>I had to symlink zconf.h and zlib.h to toolchain&rsquo;s include directory (according to link 1) and libz.so to toolchain&rsquo;s lib directory(according to link 2)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo ln -s  /usr/include/z*.h /usr/local/x86_64-cros-linux-gnu/lib/gcc/x86_64-cros-linux-gnu/8.3.0/include/
sudo ln -s /usr/lib/libz* /usr/local/x86_64-cros-linux-gnu/x86_64-cros-linux-gnu/sysroot/usr/lib/
</code></pre></div><p>Then, binutils emerged successfully</p>
<p>Next, I tried to emerge sys-devel/gcc. And it said library gmp.h was missing. So, installed it and followed the same as with zlib&rsquo;s error (same in case of mpfr and mpc)</p>
<p>Afterwards, it complained about not having the right verion of glibc <code>Error: Needed GLIBC Version 2.29</code></p>
<h3 id="summary">Summary</h3>
<p>I remounted the paritions with read/write and execute option. Then downloaded the toolchain repository, moved it to the right directory, set the path and symlinked them to /usr/bin. Later, I configured portage to pull form the gentoo repository, fetched the latest snapshot, setup make.conf and ask it to compile and build the package. Also, i did manually build some packages from source that were necessary for portage.</p>
<p>I tried to update the profile but got struck in circular dependencies. So, I am emerging those packages now. I was able to emerge sys-devel/binutils but now struck with emerging sys-devel/gcc.</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/blog/gsoc/week1/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">GSoC Week 1</span>
    </a>
    
    
    <a href="/blog/gsoc/week3/" class="navigation-next">
      <span class="navigation-tittle">GSoC Week 3</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.11.2/js/all.js" integrity="sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
